<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Flashcards Pencil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #111827;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      gap: 1rem;
    }

    h1 {
      font-size: 1.3rem;
      margin: 0.2rem 0 0.5rem;
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: #1f2937;
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .top-bar span {
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 0.4rem 0.9rem;
      font-size: 0.85rem;
      cursor: pointer;
      background: #2563eb;
      color: white;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }
    .btn.secondary {
      background: #374151;
    }
    .btn.danger {
      background: #b91c1c;
    }
    .btn:active {
      transform: translateY(1px);
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card-panel {
      background: #111827;
      border-radius: 0.75rem;
      padding: 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .card-title {
      font-size: 0.9rem;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    canvas {
      background: #0b1120;
      border-radius: 0.5rem;
      border: 1px solid #374151;
      touch-action: none; /* important pour Pencil */
    }

    .controls-row {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      margin-top: 0.4rem;
      flex-wrap: wrap;
    }

    .nav-buttons {
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .small {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .range-label {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.8rem;
      color: #9ca3af;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top-bar">
      <div>
        <h1>Flashcards Pencil</h1>
        <span>Carte <span id="cardIndex">1</span> / <span id="cardTotal">1</span></span>
      </div>
      <div class="nav-buttons">
        <button class="btn secondary" id="prevBtn">‚óÄ Pr√©c.</button>
        <button class="btn secondary" id="nextBtn">Suiv. ‚ñ∂</button>
        <button class="btn" id="newBtn">+ Nouvelle carte</button>
        <button class="btn secondary" id="saveBtn">üíæ Sauver</button>
        <button class="btn danger" id="clearAllBtn">üóë Tout effacer</button>
      </div>
    </div>

    <div class="layout">
      <div class="card-panel">
        <div class="card-title">
          <span>Question</span>
          <button class="btn secondary" id="clearQ">Effacer</button>
        </div>
        <canvas id="canvasQ" width="400" height="260"></canvas>
        <div class="controls-row">
          <span class="small">√âcris ici avec ton Pencil üí°</span>
          <label class="range-label">
            √âpaisseur :
            <input type="range" min="1" max="10" value="3" id="widthQ" />
          </label>
        </div>
      </div>

      <div class="card-panel">
        <div class="card-title">
          <span>R√©ponse</span>
          <button class="btn secondary" id="clearA">Effacer</button>
        </div>
        <canvas id="canvasA" width="400" height="260"></canvas>
        <div class="controls-row">
          <span class="small">Puis la r√©ponse ici üîÅ</span>
          <label class="range-label">
            √âpaisseur :
            <input type="range" min="1" max="10" value="3" id="widthA" />
          </label>
        </div>
      </div>
    </div>

    <div class="small" style="margin-top:0.6rem;">
      Les cartes sont sauvegard√©es sur cet appareil (localStorage).  
      Ouvre cette page sur ton iPad dans Safari et √©cris directement avec ton Apple Pencil.
    </div>
  </div>

  <script>
    // ---------- Gestion des cartes ----------
    let cards = [];
    let currentIndex = 0;

    function loadFromStorage() {
      const data = localStorage.getItem("pencilFlashcards");
      if (data) {
        try {
          cards = JSON.parse(data);
        } catch {
          cards = [];
        }
      }
      if (cards.length === 0) {
        cards.push({ question: null, answer: null });
      }
      currentIndex = 0;
      updateCardInfo();
    }

    function saveToStorage() {
      localStorage.setItem("pencilFlashcards", JSON.stringify(cards));
      alert("Cartes sauvegard√©es ‚úÖ");
    }

    function updateCardInfo() {
      document.getElementById("cardIndex").textContent = currentIndex + 1;
      document.getElementById("cardTotal").textContent = cards.length;
      loadCurrentCardToCanvas();
    }

    function newCard() {
      cards.push({ question: null, answer: null });
      currentIndex = cards.length - 1;
      clearCanvas(canvasQ, ctxQ);
      clearCanvas(canvasA, ctxA);
      updateCardInfo();
    }

    function clearAll() {
      if (!confirm("Effacer toutes les cartes ?")) return;
      cards = [{ question: null, answer: null }];
      currentIndex = 0;
      clearCanvas(canvasQ, ctxQ);
      clearCanvas(canvasA, ctxA);
      saveToStorage();
      updateCardInfo();
    }

    function goNext() {
      saveCurrentCardFromCanvas();
      if (currentIndex < cards.length - 1) {
        currentIndex++;
        updateCardInfo();
      }
    }

    function goPrev() {
      saveCurrentCardFromCanvas();
      if (currentIndex > 0) {
        currentIndex--;
        updateCardInfo();
      }
    }

    function saveCurrentCardFromCanvas() {
      cards[currentIndex].question = canvasQ.toDataURL();
      cards[currentIndex].answer = canvasA.toDataURL();
    }

    function loadCurrentCardToCanvas() {
      clearCanvas(canvasQ, ctxQ);
      clearCanvas(canvasA, ctxA);
      const card = cards[currentIndex];
      if (card.question) drawImageOnCanvas(canvasQ, ctxQ, card.question);
      if (card.answer) drawImageOnCanvas(canvasA, ctxA, card.answer);
    }

    // ---------- Gestion du dessin ----------
    function setupDrawing(canvas, ctx, widthInput) {
      let drawing = false;
      let lastX = 0;
      let lastY = 0;

      function getPos(evt) {
        const rect = canvas.getBoundingClientRect();
        let x, y;
        if (evt.touches && evt.touches.length > 0) {
          x = evt.touches[0].clientX - rect.left;
          y = evt.touches[0].clientY - rect.top;
        } else {
          x = evt.clientX - rect.left;
          y = evt.clientY - rect.top;
        }
        return { x, y };
      }

      function startDraw(evt) {
        evt.preventDefault();
        drawing = true;
        const pos = getPos(evt);
        lastX = pos.x;
        lastY = pos.y;
      }

      function draw(evt) {
        if (!drawing) return;
        evt.preventDefault();
        const pos = getPos(evt);
        ctx.strokeStyle = "#f9fafb";
        ctx.lineWidth = widthInput.value;
        ctx.lineCap = "round";
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastX = pos.x;
        lastY = pos.y;
      }

      function endDraw(evt) {
        if (!drawing) return;
        evt.preventDefault();
        drawing = false;
      }

      canvas.addEventListener("pointerdown", startDraw);
      canvas.addEventListener("pointermove", draw);
      canvas.addEventListener("pointerup", endDraw);
      canvas.addEventListener("pointerleave", endDraw);

      // Pour anciens navigateurs / iPad
      canvas.addEventListener("touchstart", startDraw, { passive: false });
      canvas.addEventListener("touchmove", draw, { passive: false });
      canvas.addEventListener("touchend", endDraw, { passive: false });
    }

    function clearCanvas(canvas, ctx) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function drawImageOnCanvas(canvas, ctx, dataUrl) {
      const img = new Image();
      img.onload = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // on adapte √† la taille du canvas
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      };
      img.src = dataUrl;
    }

    // ---------- Initialisation ----------
    const canvasQ = document.getElementById("canvasQ");
    const canvasA = document.getElementById("canvasA");
    const ctxQ = canvasQ.getContext("2d");
    const ctxA = canvasA.getContext("2d");
    const widthQ = document.getElementById("widthQ");
    const widthA = document.getElementById("widthA");

    setupDrawing(canvasQ, ctxQ, widthQ);
    setupDrawing(canvasA, ctxA, widthA);

    document.getElementById("newBtn").addEventListener("click", newCard);
    document.getElementById("prevBtn").addEventListener("click", goPrev);
    document.getElementById("nextBtn").addEventListener("click", goNext);
    document.getElementById("saveBtn").addEventListener("click", () => {
      saveCurrentCardFromCanvas();
      saveToStorage();
    });
    document.getElementById("clearAllBtn").addEventListener("click", clearAll);
    document.getElementById("clearQ").addEventListener("click", () => clearCanvas(canvasQ, ctxQ));
    document.getElementById("clearA").addEventListener("click", () => clearCanvas(canvasA, ctxA));

    loadFromStorage();
  </script>
</body>
</html>
